<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="css/public.css"/>
		<link rel="stylesheet" type="text/css" href="css/register.css"/>
		<link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_733336_428dlmu7x23.css"/>
	</head>
	<body>
		<div class="header_bg">
			<div class="header">
				<a href="index.html"><img src="img/loginlogo.jpg" alt=""></a>
				<div class="header_r">
					<span>您好，欢迎光临1号店！ </span>
					<a href="login.html">请登录</a>
					<em>帮助中心</em>
				</div>
			</div>
		</div>
		
		<!-- 主体 表单 -->
		<div class="section">
			<h1>1号店注册</h1>
			<form action="login.html" method="POST">
				<input type="text"	id="uName" placeholder="用户名/账号"/>
				<input type="number"id="phone" placeholder="手机号"/>
				<input type="text"id="code" placeholder="验证码" maxlength="6"/>
				<button id="verify">123456</button>
				<input type="password"id="pwd"	placeholder="设置密码"/>
				<input type="password"id="pwd2"	placeholder="确认密码"/>
				<p>点击注册,代表您同意1号店的
					<a href="http://cms.yhd.com/cms/view.do?topicId=10">《服务协议及隐私说明》</a>
				</p>
				<button type="submit" id="sub">注册</button>
			</form>
			<div class="tips">
				<b class="iconfont oneShop-cuo txt_red"></b>
				<b class="iconfont oneShop-duihao txt_green"></b>
				<b class="iconfont oneShop-cuo"></b>
				<b id="disange"></b>
				<b class="iconfont oneShop-duihao"></b>
				<b class="iconfont oneShop-cuo"></b>
			</div>
		</div>
		
		<div class="footer_bg">
			<div class="footer">
				<a href="http://www.miibeian.gov.cn/">&nbsp;&nbsp;沪ICP备16050468号&nbsp;&nbsp;|</a>
				<a href="http://www.miibeian.gov.cn/">&nbsp;&nbsp;沪ICP备16050468号&nbsp;&nbsp;|</a>
				<a href="http://www.miibeian.gov.cn/">&nbsp;&nbsp;沪ICP备16050468号&nbsp;&nbsp;</a>
				<br/>
				<p>Copyright © 1号店网上超市 2007-2017，All Rights Reserved</p>
			</div>
		</div>
		
	</body>
</html>
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="js/all_purpose.js" type="text/javascript" charset="utf-8"></script>
<!--<script src="js/register.js" type="text/javascript" charset="utf-8"></script>-->
<script type="text/javascript">
	var register = (function(){
		$uName = $('#uName');
		$phone = $('#phone');
		$code = $('#verify');
		$pwd = $('#pwd');
		$pwd2 = $('#pwd2');
		
		$sub = $('#sub');
//		定义随机验证码
		var ranSix = ranSixNumLet();
//		定义对错的class;
		var txt_g = 'iconfont oneShop-duihao txt_green';
		var txt_r = 'iconfont oneShop-cuo txt_red';
		return{
			init(){
				$code.html(ranSix);
				$('.tips').children('b').attr('class','');
//				这里多个b标签,有可能出bug
//				$('.tips').children('b').eq(2).attr('class',txt_g);
				this.define();
				this.events();
			},
			define(){
//				定义一个对象,把所有的正则放到对象
				var regObj = {
					'#uName':/^[a-zA-Z]+\w+$/g,
					'#phone':/^1[3,5,7,8,9]\d{9}$/g,
					'#code':/^\w{6}/g,
					'#pwd':/^\w{6,15}$/g,
					'#pwd2':/^\w{6,15}$/g
				};
//				把对象的正则加到相应的input的pattern属性里
				for (var i in regObj) {
					$(i).attr('pattern',regObj[i]);
				}
			},
			events(){
				var _this = this;
//				点击输入框input,鼠标移开时进行的操作
				$('form').children('input').on('blur',function(){
//					输入的值是否符合正则表达式的要求
					if(eval($(this).attr('pattern')).test($(this).val())){
//						如果点击第二个,特殊处理
						if ($(this).index() == 2) {
//							输入框的值是否等于随机框的值
							if ($(this).val() == ranSix) {
								$('.tips').children('b').eq(2).attr('class',txt_g);
							}else{
								$('.tips').children('b').eq(2).attr('class',txt_r);
							}
						}else if($(this).index() == 5){
							if ($(this).val() == $(this).prev('input').val()) {
								$('.tips').children('b').eq(5).attr('class',txt_g);
							} else{
								$('.tips').children('b').eq(5).attr('class',txt_r);
							}
						}else{
							console.log($(this).index())
//							这个判断是除第二个和最后一个,其他input进行判断 且正确 执行的
							$('.tips').children('b').eq($(this).index()).attr('class',txt_g);							
						}
					}else{
//						这个判断是除第二个和最后一个,,其他input进行判断 且错误 执行的
						$('.tips').children('b').eq($(this).index()).attr('class',txt_r);
					}
				});
				
				$('body').on('mousemove',function(){

				});
				
				$code.on('click',function(e){
					e.preventDefault();
					ranSix = ranSixNumLet();
					$code.html(ranSix);
				});
				
				$sub.on('click',function(e){
					e.preventDefault();
						var params = {
							username:$('#uName').val(),
							password:$('#pwd').val(),
							phone:$('#phone').val()
						}
						$.post('php/register.php',params,_this.cbRegister,'json');

				})
			},
			cbRegister(json){
				if (json.code == 200) {
					alert('注册成功!跳转到登录');
					window.location.href = 'login.html';
				}
			}
		}
	})();
	register.init();
</script>